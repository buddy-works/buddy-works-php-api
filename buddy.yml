- pipeline: "tests"
  trigger_mode: "ON_EVERY_PUSH"
  ref_name: "*"
  ref_type: "WILDCARD"
  trigger_condition: "ALWAYS"
  actions:
    - action: "Install dependencies"
      type: "BUILD"
      working_directory: "/buddy/buddy-works-php-api"
      docker_image_name: "library/php"
      docker_image_tag: "7.2-stretch"
      execute_commands:
        - "composer install"
      setup_commands:
        - "apt-get update && apt-get install -y git zip"
        - "curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer"
      mount_filesystem_path: "/buddy/buddy-works-php-api"
      shell: "BASH"
      trigger_condition: "ALWAYS"
    - action: "Static analysis"
      type: "BUILD"
      working_directory: "/buddy/buddy-works-php-api"
      docker_image_name: "library/php"
      docker_image_tag: "7.2-stretch"
      execute_commands:
        - "composer analyse"
      mount_filesystem_path: "/buddy/buddy-works-php-api"
      shell: "BASH"
      trigger_condition: "ALWAYS"
    - action: "PHP 7.2"
      type: "BUILD"
      working_directory: "/buddy/buddy-works-php-api"
      docker_image_name: "library/php"
      docker_image_tag: "7.2-stretch"
      execute_commands:
        - "vendor/bin/phpunit"
      mount_filesystem_path: "/buddy/buddy-works-php-api"
      shell: "BASH"
      trigger_condition: "ALWAYS"
      run_next_parallel: true
    - action: "PHP 7.3"
      type: "BUILD"
      working_directory: "/buddy/buddy-works-php-api"
      docker_image_name: "library/php"
      docker_image_tag: "7.3-stretch"
      execute_commands:
        - "vendor/bin/phpunit"
      mount_filesystem_path: "/buddy/buddy-works-php-api"
      shell: "BASH"
      trigger_condition: "ALWAYS"
